{% extends 'base.html' %}
{% load static %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/facility_list.css' %}" />
{% endblock %}

{% block script1 %}
<!-- ì¹´ì¹´ì˜¤ ì§€ë„ JS -->
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey={{ KAKAO_SCRIPT_KEY }}"></script>
<script src="{% static 'js/facility_list.js' %}"></script>
{% autoescape off %}
<script>
    var facilities = {{ page_facilities| safe }};
    console.log("ì§€ë„ìš© ì‹œì„¤ ë°ì´í„°:", facilities);
</script>
{% endautoescape %}
{% endblock %}

{% block title %}
ì‹œì„¤ ëª©ë¡ - í• ë˜ë§ë˜
{% endblock %}

{% block contents %}

<div class="page-title-section">
    <h2 class="page-title">ì‹œì„¤ ëª©ë¡</h2>
</div>

<div class="sub-container">
    <div class="sub-content">
        <!-- ê²€ìƒ‰ ì˜ì—­ -->
        <section class="search-section">
            <form id="facilitySearchForm" action="{% url 'list' %}" method="GET">

                <!-- ì‹œ/ë„ + êµ¬/êµ° -->
                <div class="search-controls">
                    <select name="cpNm" id="sido" class="search-dropdown">
                        <option value="">ì‹œ/ë„ ì„ íƒ</option>
                    </select>

                    <select name="cpbNm" id="sigungu" class="search-dropdown">
                        <option value="">êµ¬/êµ° ì„ íƒ</option>
                    </select>
                </div>

                <!-- ê²€ìƒ‰ input -->
                <div class="search-input-group">
                    <input type="text" class="search-input" id="searchKeyword" name="keyword" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                        value="{{ keyword }}">

                    <button type="submit" class="search-btn">
                        <span>ğŸ”</span> ê²€ìƒ‰
                    </button>
                </div>

            </form>
        </section>
        <!-- ì§€ë„ -->
        <section class="map">
            <div id="map" style="width:100%; height:400px; border-radius:10px;"></div>
        </section>

        <!-- ë¦¬ìŠ¤íŠ¸ -->
        <section class="search-list-section">
            ì´ {{ merged_count }} ê°œ
            <hr class="dividing-line">

            <div class="facility-list">
                <ul>
                    {% for item in page_obj %}
                    <li class="facility-item">
                        <span class="facility-order">{{ forloop.counter }}</span>

                        <span class="facility-title">
                            <!-- í´ë¦­ ì´ë²¤íŠ¸ìš© data-id ì¶”ê°€ -->
                            <a href="javascript:void(0);" class="facility-link" data-id="{{ item.id }}">
                                {{ item.name }}
                            </a>
                        </span>

                        <span class="facility-meta">{{ item.phone }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </section>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        <div class="pagination">

            <!-- ì´ì „ ë²„íŠ¼ -->
            {% if block_start > 1 %}
            <a href="?page={{ block_start|add:-1 }}&per_page={{ per_page }}&cpNm={{ cpNm }}&cpbNm={{ cpbNm }}&keyword={{ keyword }}"
                class="page-btn arrow">â—€ ì´ì „</a>
            {% else %}
            <span class="page-btn arrow disabled">â—€ ì´ì „</span>
            {% endif %}


            <!-- ë²ˆí˜¸ ë²„íŠ¼ -->
            {% for num in block_range %}
            {% if num == page_obj.number %}
            <span class="page-btn active">{{ num }}</span>
            {% else %}
            <a href="?page={{ num }}&per_page={{ per_page }}&cpNm={{ cpNm }}&cpbNm={{ cpbNm }}&keyword={{ keyword }}"
                class="page-btn">{{ num }}</a>
            {% endif %}
            {% endfor %}


            <!-- ë‹¤ìŒ ë²„íŠ¼ -->
            {% if block_end < paginator.num_pages %} <a
                href="?page={{ block_end|add:1 }}&per_page={{ per_page }}&cpNm={{ cpNm }}&cpbNm={{ cpbNm }}&keyword={{ keyword }}"
                class="page-btn arrow">ë‹¤ìŒ â–¶</a>
                {% else %}
                <span class="page-btn arrow disabled">ë‹¤ìŒ â–¶</span>
                {% endif %}
        </div>


    </div>
</div>

{% endblock %}

{% block script3 %}
<script>
    document.addEventListener("DOMContentLoaded", function () {



    });
</script>
{% endblock %}