{% extends 'manager/manager_base.html' %}
{% load static %}

{% block title %}ì‹œì„¤ ì •ë³´ ìˆ˜ì •{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'manager/css/facility_modify.css' %}">

{% endblock %}

{% block content %}

<div class="modify-container">

    <h1 class="modify-header">ì‹œì„¤ ì •ë³´ ìˆ˜ì •</h1>

    <form id="modifyForm" method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="facility-info-box">
            <h2 class="section-title">ê¸°ë³¸ ì •ë³´</h2>

            <div class="info-row">
                <span class="info-label">ì‹œì„¤ëª…</span>
                <span class="info-value">{{ info.faci_nm }}</span>
            </div>

            <div class="info-row">
                <span class="info-label">ì£¼ì†Œ</span>
                <span class="info-value">{{ info.address }}</span>
            </div>

            <div class="info-row">
                <span class="info-label">ì „í™”ë²ˆí˜¸</span>
                <span class="info-value">
                    <input type="text" name="tel" value="{{ info.tel }}">
                </span>
            </div>

            <div class="info-row">
                <span class="info-label">í™ˆí˜ì´ì§€</span>
                <span class="info-value">
                    <input type="text" name="homepage" value="{{ info.homepage }}">
                </span>
            </div>
        </div>

        <div class="photo-box">
            <h2 class="section-title">ëŒ€í‘œ ì´ë¯¸ì§€</h2>

            <div class="photo-flex">

                <div id="previewArea">
                    {% if info.photo %}
                    <img src="{{ info.photo.url }}" class="facility-photo" id="previewImage">
                    {% else %}
                    <div class="photo-placeholder" id="previewPlaceholder">ì´ë¯¸ì§€ ì—†ìŒ</div>
                    <img id="previewImage" class="facility-photo" style="display:none;">
                    {% endif %}
                </div>

                <div class="photo-upload-area">
                    <input type="file" name="photo" id="photoInput" class="photo-input" accept="image/*">
                </div>

            </div>
        </div>

        <div class="file-box">
            <h2 class="section-title">ì²¨ë¶€íŒŒì¼</h2>

            <!-- ê¸°ì¡´ íŒŒì¼ ëª©ë¡ -->
            {% if files %}
            <ul class="attached-list">
                {% for f in files %}
                <li class="attached-item" data-id="{{ f.add_info_id }}">
                    <span class="file-name">{{ f.file_name }}</span>

                    <button type="button"
                            class="delete-existing-btn"
                            data-file-id="{{ f.add_info_id }}"
                            style="background:#ff4d4d; color:white; border:none; padding:2px 6px; cursor:pointer; border-radius:3px;">
                        X
                    </button>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <p>ì²¨ë¶€ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endif %}

            <!-- ìƒˆ íŒŒì¼ ì—…ë¡œë“œ UI -->
            <div class="file-upload-wrapper">
                <input type="file" name="file" id="fileInput" class="file-input" multiple>
                <label for="newFileInput" class="file-upload-btn">ğŸ“ íŒŒì¼ ì„ íƒ</label>
                <div class="file-list" id="fileList"></div> 
            </div>
        </div>

        <div class="reserve-posible" style="margin-bottom:20px;">
            <label for="rsPosible">ì˜ˆì•½í•˜ê¸° í™œì„±í™”</label>
            <input type="checkbox"
                   id="rsPosible"
                   name="rs_posible"
                   value="1"
                   {% if info.rs_posible == 1 %}checked{% endif %}>
        </div>



        <div id="timeSettingBox" class="time-setting-box {% if info.rs_posible == 0 %}time-disabled{% endif %}">
            <h2 class="time-setting-title">ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„ ì„¤ì •</h2>

            <div class="time-setting-layout">
                <!-- ì¢Œì¸¡: ìš”ì¼ë³„ ê°€ëŠ¥í•œ ì‹œê°„ -->
                <div class="weekly-time-panel">
                    <h3 class="panel-title">ìš”ì¼ë³„ ê°€ëŠ¥í•œ ì‹œê°„</h3>
                    
                    <div class="weekly-time-content">
                        <!-- ìš”ì¼ íƒ­ (ì„¸ë¡œ) -->
                        <div class="day-tabs">
                            <button type="button" class="day-tab" data-day="monday">ì›”</button>
                            <button type="button" class="day-tab" data-day="tuesday">í™”</button>
                            <button type="button" class="day-tab" data-day="wednesday">ìˆ˜</button>
                            <button type="button" class="day-tab" data-day="thursday">ëª©</button>
                            <button type="button" class="day-tab" data-day="friday">ê¸ˆ</button>
                            <button type="button" class="day-tab" data-day="saturday">í† </button>
                            <button type="button" class="day-tab" data-day="sunday">ì¼</button>
                        </div>

                        <!-- ì„ íƒëœ ìš”ì¼ì˜ ì‹œê°„ êµ¬ê°„ í¸ì§‘ ì˜ì—­ -->
                        <div class="time-slots-editor">
                            <!-- ë‹¨ì¼ ìš”ì¼ ì„ íƒ ì‹œ ì‹œê°„ + ìš”ê¸ˆ ì¶”ê°€ UI -->
                            <div class="single-day-add-section" id="singleDayAddSection" style="display: none;">
                                <div class="single-day-time-payment-section">
                                    <label>ì‹œê°„ ë° ìš”ê¸ˆ ì¶”ê°€:</label>
                                    <div class="single-day-inputs-group">
                                        <div class="single-day-time-inputs">
                                            <input type="time" id="singleStartTime" value="10:00">
                                            <span class="time-separator">~</span>
                                            <input type="time" id="singleEndTime" value="19:00">
                                        </div>
                                        <div class="single-day-payment-input-wrapper">
                                            <input type="text" id="singlePayment" placeholder="ìš”ê¸ˆ (ê¸°ë³¸: 0ì›)" class="single-payment-input" value="0">
                                        </div>
                                        <button type="button" class="btn-single-add" id="btnSingleAdd">ì¶”ê°€</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ë‹¤ì¤‘ ì„ íƒ ì •ë³´ ë° ì¼ê´„ ì‘ì—… -->
                            <div class="multi-select-actions" id="multiSelectActions" style="display: none;">
                                <div class="selected-days-info">
                                    <span id="selectedDaysCount">0</span>ê°œ ìš”ì¼ ì„ íƒë¨
                                </div>
                                <div class="batch-actions">
                                    <div class="batch-time-payment-section">
                                        <label>ì¼ê´„ ì‹œê°„ ë° ìš”ê¸ˆ ì¶”ê°€:</label>
                                        <div class="batch-inputs-group">
                                            <div class="batch-time-inputs">
                                                <input type="time" id="batchStartTime" value="10:00">
                                                <span class="time-separator">~</span>
                                                <input type="time" id="batchEndTime" value="19:00">
                                            </div>
                                            <div class="batch-payment-input-wrapper">
                                                <input type="text" id="batchPayment" placeholder="ìš”ê¸ˆ (ê¸°ë³¸: 0ì›)" class="batch-payment-input" value="0">
                                            </div>
                                            <button type="button" class="btn-batch-add" id="btnBatchAdd">ì¶”ê°€</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="time-slots-list" id="timeSlotsList">
                                <!-- ì‹œê°„ êµ¬ê°„ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ìš°ì¸¡: í™œì„±í™”ëœ ìš”ì¼ê³¼ ì‹œê°„ í‘œì‹œ -->
                <div class="active-time-panel">
                    <div class="panel-header">
                        <h3 class="panel-title">í™œì„±í™”ëœ ìš”ì¼ê³¼ ì‹œê°„</h3>
                    </div>
                    <p class="panel-description">
                        í˜„ì¬ ì„¤ì •ëœ ìš”ì¼ë³„ ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                    
                    <div class="active-days-summary" id="activeDaysSummary">
                        <!-- í™œì„±í™”ëœ ìš”ì¼ê³¼ ì‹œê°„ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ í‘œì‹œë¨ -->
                    </div>
                </div>
            </div>

            <input type="hidden" id="reservationTimeInput" name="reservation_time">
        </div>


        <div class="btn-bottom-area">
            <a href="{% url 'manager:facility_list' %}" class="btn-back">â† ëª©ë¡ìœ¼ë¡œ</a>
            <button type="submit" class="btn-save-all">ì „ì²´ ì €ì¥</button>
        </div>
        

    </form>

</div>

{% endblock %}

{% block extra_js %}
<script id="timeJson" type="application/json">
    {{ time_json|safe }}
</script>

<!-- ê¸°ì¡´ JS -->
<script src="{% static 'manager/js/facility_modify.js' %}"></script>
<script src="{% static 'common/js/board/fileupload.js' %}"></script>

{% endblock %}
