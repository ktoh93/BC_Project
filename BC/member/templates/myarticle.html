{% extends 'base.html' %}
{% load static %}
{% block css %}
<link rel="stylesheet" href="{% static 'css/mypage_base.css' %}" />
<link rel="stylesheet" href="{% static 'css/mypage.css' %}" />
{% endblock %}
{% block mypagecss %}
{% endblock %}

{% block script1 %}
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script src="{% static 'js/mypage_list.js' %}"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    /* CSRF í† í° ê°€ì ¸ì˜¤ê¸° */
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    const csrftoken = getCookie('csrftoken');

    /* ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ */
    document.querySelectorAll('.mypage-delete-btn').forEach(function(btn) {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const articleId = this.getAttribute('data-article-id');
            
            if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            fetch('/member/api/article/delete/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken
                },
                body: JSON.stringify({ article_id: parseInt(articleId) })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'ok') {
                    alert('ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    location.reload();
                } else {
                    alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + data.msg);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        });
    });
});
</script>
{% endblock %}
{% block title %}
mypage base
{% endblock %}
{% block contents %}
<!-- íšŒì›ê°€ì… ì»¨í…Œì´ë„ˆ -->
<div class="register-container">
  <div class="register-wrapper">

    <!-- PC ë¸Œëœë”© -->
    <div class="register-brand">
      <h2>My Page</h2>
      <ul class="register-brand-features">
        <li><a href="/member/info/">ë‚´ ì •ë³´</a></li>
        <li><a href="/member/myreservation/">ë‚´ ì˜ˆì•½ ë‚´ì—­</a></li>
        <li><a href="/member/myrecruitment/">ë‚´ ëª¨ì§‘ê¸€</a></li>
        <li><a href="/member/myarticle/">ë‚´ ê²Œì‹œê¸€</a></li>
        <li><a href="/member/myjoin/">ë‚´ ì°¸ì—¬ ë‚´ì—­</a></li>
      </ul>
    </div>
    
    
    
    
    
    
    
    
    
    <!-- mypageë‚´ìš© ë‹´ì„ container -->
    <main class="main">

    <h2>ë‚˜ì˜ ììœ ê²Œì‹œíŒ</h2>



<section class="mypage-board">

  <!-- ìƒë‹¨ ì •ë ¬/ê°œìˆ˜ ì„ íƒ -->
  <div class="mypage-board-top">
    <div class="mypage-board-top-left">
      <select class="mypage-select" name="order">
        <option value="recent">ìµœì‹ ìˆœ</option>
        <option value="title">ì œëª©ìˆœ</option>
        <option value="views">ì¡°íšŒìˆ˜ìˆœ</option>
      </select>
    </div>

    <div class="mypage-board-top-right">
      <select class="mypage-select" name="page_size">
        <option value="15">15ê°œ</option>
        <option value="30">30ê°œ</option>
        <option value="50">50ê°œ</option>
      </select>
    </div>
  </div>

  <!-- ëª©ë¡ ì˜ì—­ -->
  <div class="mypage-board-list">
    <!-- í—¤ë” -->
    <div class="mypage-board-header">
      <span class="col-number">ë²ˆí˜¸</span>
      <span class="col-title">ì œëª©</span>
      <span class="col-date">ë‚ ì§œ</span>
      <span class="col-views">ì¡°íšŒìˆ˜</span>
    </div>
    {% for article in page_obj %}
      <!-- í•œ ì¤„ ì „ì²´ê°€ í´ë¦­ë˜ëŠ” í–‰ -->
      <div class="mypage-board-row-wrapper">
        <a href="/board/post/{{ article.article_id }}/" class="mypage-board-row">
          <span class="col-number">{{ forloop.counter0|add:page_obj.start_index }}</span>
          <span class="col-title">{{ article.title }}</span>
          <span class="col-date">{{ article.reg_date|date:"Y-m-d" }}</span>
          <span class="col-views">ì¡°íšŒìˆ˜ {{ article.view_cnt }}</span>
        </a>
        <button type="button" class="mypage-delete-btn" data-article-id="{{ article.article_id }}">ì‚­ì œ</button>
      </div>
    {% empty %}
      <div class="mypage-board-empty">
        ì‘ì„±í•œ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
      </div>
    {% endfor %}
  </div>

  <!-- í•˜ë‹¨ ì‘ì„± ë²„íŠ¼ -->
  <div class="mypage-board-bottom">
    <button type="button" class="mypage-write-btn">ì‘ì„±í•˜ê¸°</button>
  </div>

</section>





    <!-- í˜ì´ì§• ë²ˆí˜¸ -->

    <div class="pagination">

        <!-- ğŸ”¹ ì´ì „ ë¸”ë¡ -->
        {% if block_start > 1 %}
            <a href="?page={{ block_start|add:-1 }}&per_page={{ per_page }}&sort={{ sort }}" class="page-btn arrow">â—€ ì´ì „</a>
        {% else %}
            <span class="page-btn arrow disabled">â—€ ì´ì „</span>
        {% endif %}

        <!-- ğŸ”¹ í˜ì´ì§€ ë²ˆí˜¸ 5ê°œì”© ë¸”ë¡ -->
        {% for num in block_range %}
            {% if num == page_obj.number %}
                <span class="page-btn active">{{ num }}</span>
            {% else %}
                <a href="?page={{ num }}&per_page={{ per_page }}&sort={{ sort }}" class="page-btn">{{ num }}</a>
            {% endif %}
        {% endfor %}

        <!-- ğŸ”¹ ë‹¤ìŒ ë¸”ë¡ -->
        {% if block_end < paginator.num_pages %}
            <a href="?page={{ block_end|add:1 }}&per_page={{ per_page }}&sort={{ sort }}" class="page-btn arrow">ë‹¤ìŒ â–¶</a>
        {% else %}
            <span class="page-btn arrow disabled">ë‹¤ìŒ â–¶</span>
        {% endif %}

    </div>


    </main>






  </div> <!-- register-wrapper -->
</div> <!-- register-container -->


{% endblock %}