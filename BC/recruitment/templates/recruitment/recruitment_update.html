{% extends 'common/base.html' %}
{% load static %}

{% block title %}
í• ë˜ë§ë˜ - ëª¨ì§‘ê¸€ ìˆ˜ì •
{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'recruitment/css/recruitment_list.css' %}" />
<link rel="stylesheet" href="{% static 'recruitment/css/recruitment_write.css' %}" />
{% endblock %}

{% block script1 %}
<script src="{% static 'recruitment/js/recruitment_update.js' %}"></script>
{% endblock %}

{% block contents %}

<!-- Hero ì„¹ì…˜ -->
<div class="board-hero recruitment-hero">
    <h2>ëª¨ì§‘í• ë˜ ìˆ˜ì •</h2>
</div>

<!-- ì„œë¸Œ ì»¨í…Œì´ë„ˆ -->
<div class="sub-container">
    <div class="sub-content">

        <!-- ì‘ì„± í¼ (CSS ìœ ì§€ ìœ„í•´ div ëŒ€ì‹  formë§Œ ì ìš©) -->
        <form id="recruit_form"
              class="recruitmnent-write-form"
              method="post"
              action="{% url 'recruitment:recruitment_update' recruit.community_id %}">
            {% csrf_token %}

            <div class="form-wrapper">

                <!-- 1. ì œëª© -->
                <div class="form-group full-row">
                    <label class="form-label">ì œëª©</label>
                    <input type="text"
                           class="form-input"
                           name="title"
                           value="{{ recruit.title }}"
                           readonly>
                </div>

                <!-- 2. ì§€ì—­ / ì¢…ëª© / ì¸ì› -->
                <div class="form-row">
                    <div class="form-group small">
                        <label class="form-label">ì‹œ / ë„</label>
                        <input type="text"
                               class="form-input"
                               name="region"
                               value="{{ recruit.region }}"
                               readonly>
                    </div>

                    <div class="form-group small">
                        <label class="form-label">êµ¬ / êµ°</label>
                        <input type="text"
                               class="form-input"
                               name="region2"
                               value="{{ recruit.region2 }}"
                               readonly>
                    </div>

                    <div class="form-group small">
                        <label class="form-label">ì¢…ëª©</label>
                        <input type="text"
                               class="form-input"
                               name="sport_type"
                               value="{{ recruit.sport_type }}"
                               readonly>
                    </div>

                    <div class="form-group small">
                        <label class="form-label">ëª¨ì§‘ ì¸ì›</label>
                        <input type="number"
                               class="form-input"
                               name="num_member"
                               value="{{ recruit.num_member }}"
                               readonly>
                    </div>
                </div>




                
                    {# grp.reservation, grp.facility, grp.times ì‚¬ìš© #}
                    <label class="form-label">ì‹œì„¤</label>
                    <select name="reservation_choice" id="reservation_choice" class="form-input">
                        <option value="">ì‹œì„¤ ì„ íƒ</option>

                        {% for grp in my_reservation_slots %}
                            <option value="{{ grp.reservation.reservation_id }}"
                                {% if grp.reservation.reservation_id == current_reservation_id %}selected{% endif %}>
                                {{ grp.facility.faci_nm }}
                                {{ grp.times.0.date }} 
                                ({% for t in grp.times %}
                                    {{ t.start_time }}~{{ t.end_time }} 
                                {% endfor %})
                            </option>
                        {% endfor %}
                    </select>





                <!-- 4. ë‚´ìš© (ìˆ˜ì • ê°€ëŠ¥í•œ ìœ ì¼í•œ í•„ë“œ) -->
                <div class="form-group full-row">
                    <label class="form-label">ë‚´ìš©</label>
                <textarea class="form-textarea"
                    name="content"    
                    rows="6">{{ recruit.contents }}</textarea>
                </div>

                <!-- 5. ì˜¤í”ˆì¹´í†¡ URL (ìˆ˜ì • ê°€ëŠ¥í•˜ê²Œ ë³€ê²½ ê°€ëŠ¥) -->
                <div class="form-group full-row">
                    <label class="form-label">ì˜¤í”ˆì¹´í†¡ URL</label>
                    <input type="text"
                           class="form-input"
                           name="chat_url"
                           value="{% if recruit.char_url %}{{ recruit.chat_url }}{% endif %}">
                </div>
                
                
                <!-- ì²¨ë¶€íŒŒì¼ -->
                <div class="form-group full-row">
                <label class="form-label">ì²¨ë¶€íŒŒì¼</label>
                <div class="file-upload-wrapper">
                    <input type="file" name="files" id="fileInput" class="file-input" multiple>
                    <label for="fileInput" class="file-upload-btn">
                    <span>ğŸ“ íŒŒì¼ ì„ íƒ</span>
                    </label>
                    <div class="file-list" id="fileList"></div>
                </div>
                </div>

                
                <!-- 7. ë²„íŠ¼ -->
                <div class="btn-row">
                    <button type="button" class="btn btn-submit">ìˆ˜ì •</button>
                    <button type="button" class="btn btn-list">ëª©ë¡</button>
                </div>

            </div>
        </form>

    </div>
</div>

{% endblock %}

{% block script3 %}
<script>
document.addEventListener("DOMContentLoaded", () => {
    const fileInput = document.querySelector('input[type="file"]');
    if (!fileInput) return;

    fileInput.addEventListener("change", function() {
        const maxSize = 2 * 1024 * 1024; // 2MB
        const files = this.files;

        for (let f of files) {
            if (f.size > maxSize) {
                alert(`"${f.name}" ì€(ëŠ”) 2MBë¥¼ ì´ˆê³¼í•˜ì—¬ ì—…ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                this.value = "";  // ì„ íƒí•œ íŒŒì¼ ì „ì²´ ì´ˆê¸°í™”
                return;
            }
        }
    });
});
</script>

{% endblock %}